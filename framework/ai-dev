#!/bin/bash
# AI Development CLI - 256GB Optimized

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Colors
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m'

log() { echo -e "${BLUE}[ai-dev]${NC} $1"; }
success() { echo -e "${GREEN}[ai-dev]${NC} $1"; }

# Check model servers
check_servers() {
    for port in 8080 8081 8082; do
        if ! curl -s "http://127.0.0.1:$port/health" > /dev/null 2>&1; then
            echo "âš ï¸  Model server on port $port not running"
            echo "   Start with: ./start.sh (in parent directory)"
            return 1
        fi
    done
    return 0
}

case "$1" in
    init)
        log "Initializing AI development environment..."
        if check_servers; then
            success "All systems ready"
            echo ""
            echo "Commands:"
            echo "  ./ai-dev build    - Build next feature"
            echo "  ./ai-dev status   - Check system status"
        fi
        ;;
    
    build)
        if ! check_servers; then exit 1; fi
        "$SCRIPT_DIR/scripts/build-local.sh"
        ;;
    
    status)
        echo "ðŸ“Š System Status"
        echo ""
        for port in 8080 8081 8082; do
            case $port in
                8080) NAME="Builder (Qwen 32B)" ;;
                8081) NAME="Reviewer (DeepSeek 16B)" ;;
                8082) NAME="Drift (Qwen 14B)" ;;
            esac
            if curl -s "http://127.0.0.1:$port/health" > /dev/null 2>&1; then
                echo "âœ“ $NAME: ONLINE"
            else
                echo "âœ— $NAME: OFFLINE"
            fi
        done
        ;;
    
    *)
        echo "AI Development CLI (256GB Optimized)"
        echo ""
        echo "Usage:"
        echo "  ./ai-dev init      - Initialize"
        echo "  ./ai-dev build     - Build next feature"
        echo "  ./ai-dev status    - Check status"
        ;;
esac

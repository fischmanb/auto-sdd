---
description: Specs-driven development workflow with design system integration
alwaysApply: true
---

# Specs-Driven Development Workflow

This project uses a specs-driven workflow. The `.specs/` directory contains:
- `features/` - Gherkin feature specifications with ASCII mockups
- `test-suites/` - Documentation of what each test file covers
- `design-system/` - Design tokens and component patterns
- `mapping.md` - Links features â†” tests â†” components â†” design

## Directory Structure

```
.specs/
â”œâ”€â”€ features/              # Gherkin specs with ASCII mockups
â”‚   â””â”€â”€ {domain}/
â”‚       â””â”€â”€ {feature}.feature.md
â”œâ”€â”€ test-suites/           # Test documentation
â”‚   â””â”€â”€ {mirrors test dir structure}
â”œâ”€â”€ design-system/         # Design tokens and patterns
â”‚   â”œâ”€â”€ tokens.md          # Colors, spacing, typography
â”‚   â””â”€â”€ components/        # Component pattern docs
â”‚       â””â”€â”€ {component}.md
â”œâ”€â”€ mapping.md             # Links everything together
â”œâ”€â”€ codebase-summary.md    # Generated by /spec-init
â””â”€â”€ needs-review.md        # Files that need manual attention
```

---

## Workflow: Greenfield vs Existing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GREENFIELD (New Project)                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  git sdd (clone template) â†’ /spec-first {feature}                       â”‚
â”‚                                   â”‚                                     â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                    â–¼              â–¼              â–¼                      â”‚
â”‚              Create/detect   Create spec   Create ASCII                 â”‚
â”‚              design tokens   with Gherkin  mockup                       â”‚
â”‚                    â”‚              â”‚              â”‚                      â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                   â”‚                                     â”‚
â”‚                                   â–¼                                     â”‚
â”‚                            STOP for approval                            â”‚
â”‚                                   â”‚                                     â”‚
â”‚                                   â–¼                                     â”‚
â”‚                         Write failing tests                             â”‚
â”‚                                   â”‚                                     â”‚
â”‚                                   â–¼                                     â”‚
â”‚                         Implement until pass                            â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EXISTING PROJECT                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  git sdd (clone template) â†’ /spec-init                                  â”‚
â”‚                                   â”‚                                     â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                    â–¼              â–¼              â–¼                      â”‚
â”‚              Detect env      Scan codebase  Detect existing             â”‚
â”‚              & test runner   for files      design system               â”‚
â”‚                    â”‚              â”‚              â”‚                      â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                   â”‚                                     â”‚
â”‚                                   â–¼                                     â”‚
â”‚                    Loop: document each file                             â”‚
â”‚                    (spec â†’ test doc â†’ mapping)                          â”‚
â”‚                                   â”‚                                     â”‚
â”‚                                   â–¼                                     â”‚
â”‚                         Verify 100% coverage                            â”‚
â”‚                                   â”‚                                     â”‚
â”‚                                   â–¼                                     â”‚
â”‚                    Then use /spec-first for new features                â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## The Core Loop (TDD + Design + Learning)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DESIGN    â”‚ â”€â”€â–¶ â”‚    SPEC     â”‚ â”€â”€â–¶ â”‚    TEST     â”‚ â”€â”€â–¶ â”‚ IMPLEMENT   â”‚
â”‚ (tokens +   â”‚     â”‚ (Gherkin +  â”‚     â”‚  (failing)  â”‚     â”‚ (loop until â”‚
â”‚  stubs)     â”‚     â”‚  mockup)    â”‚     â”‚             â”‚     â”‚ tests pass) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                                            â”‚
       â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚
       â”‚                    â–¼
       â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Document   â”‚ â”€â”€â–¶ â”‚  COMPOUND   â”‚
                    â”‚  component  â”‚     â”‚ (learnings) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step by Step:

1. **DESIGN** - On first feature, create design tokens. For new components, create stubs.
2. **SPEC** - Create Gherkin scenarios + ASCII mockup referencing design system
3. **TEST** - Write failing tests covering all scenarios
4. **IMPLEMENT** - Code until tests pass
5. **DOCUMENT** - Fill in component stubs with actual implementation details
6. **COMPOUND** - (Optional) Run `/compound` to extract learnings from the session

---

## Design System Integration

### When `/spec-first` Runs on Greenfield

If no design system exists:
1. Auto-create `.specs/design-system/tokens.md` with sensible defaults
2. Create `.cursor/rules/design-tokens.mdc` (generated Cursor rule)
3. Proceed with feature spec

### When a Spec References New Components

If ASCII mockup references a component that doesn't exist in `.specs/design-system/components/`:
1. Auto-create a **stub** file: `.specs/design-system/components/{component}.md`
2. Stub includes: name, purpose, "pending implementation" status
3. After implementation, stub gets filled in (manually or via `/document-component`)

### Design System File Locations

| File | Purpose |
|------|---------|
| `.specs/design-system/tokens.md` | Colors, spacing, typography, radii, shadows |
| `.specs/design-system/components/{name}.md` | Component patterns and variants |
| `.specs/design-system/layouts/{name}.md` | Page/section layout patterns |
| `.cursor/rules/design-tokens.mdc` | Cursor rule enforcing token usage |

---

## Feature Spec Format (with ASCII Mockup)

Every feature spec in `.specs/features/` should include **YAML frontmatter** that powers the auto-generated mapping:

```markdown
---
feature: Feature Name
domain: domain-name
source: path/to/file.tsx
tests: []
components: []
design_refs: []
status: stub    # stub â†’ specced â†’ tested â†’ implemented
created: YYYY-MM-DD
updated: YYYY-MM-DD
---

# Feature Name

**Source File**: `path/to/file.tsx`
**Design System**: `.specs/design-system/tokens.md`

## Feature: [Name]

### Scenario: [Happy path]
Given [precondition]
When [action]
Then [expected result]

### Scenario: [Edge case]
Given [precondition]
When [action]
Then [expected result]

## UI Mockup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Component layout with ASCII art        â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Image  â”‚  â”‚ Text content        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ [Button (primary)]  â”‚   â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component References

- Button: `.specs/design-system/components/button.md`
- Card: `.specs/design-system/components/card.md` (stub)

## Learnings

<!-- Updated via /compound -->
```

### Frontmatter Fields

| Field | Description | When to Update |
|-------|-------------|----------------|
| `status` | stub â†’ specced â†’ tested â†’ implemented | Each workflow stage |
| `tests` | Array of test file paths | After writing tests |
| `components` | Array of component names | After implementation |
| `updated` | Last modified date | Any change |

---

## Available Slash Commands

### Setup Commands

| Command | Purpose | When to Use |
|---------|---------|-------------|
| `/spec-init` | Bootstrap on existing codebase | First time on existing project |
| `/spec-first` | Create spec + mockup for new feature | Starting any new feature |

### Core Workflow Commands

| Command | Purpose |
|---------|---------|
| `/document-code` | Generate specs/tests from existing code (reverse TDD) |
| `/prototype` | Rapid prototyping without specs/tests |
| `/formalize` | Convert prototype to production code with full specs |
| `/compound` | Extract and persist learnings from current session |

### Design System Commands

| Command | Purpose |
|---------|---------|
| `/design-tokens` | Create or update design tokens |
| `/design-component` | Document a component pattern (fill in stub) |

### Bug Fixing & Refactoring

| Command | Purpose |
|---------|---------|
| `/fix-bug` | Investigate and fix bugs with regression tests |
| `/refactor` | Refactor code while ensuring tests still pass |

### Documentation & Maintenance

| Command | Purpose |
|---------|---------|
| `/check-coverage` | Compare specs against tests to find gaps |
| `/update-test-docs` | Sync test documentation with actual tests |
| `/catch-drift` | Detect and reconcile spec â†” code drift |
| `/verify-test-counts` | Run tests and reconcile counts vs documentation |

### Git Workflow

| Command | Purpose |
|---------|---------|
| `/start-feature` | Sync with main branch and create new feature branch |
| `/code-review` | Review code against senior engineering standards |

---

## Pause Triggers

If the user says any of these (or similar), create the spec and **STOP** - wait for approval:
- "let me review first"
- "write the spec first"
- "show me the Gherkin"
- "spec this out"
- "don't implement yet"
- "plan this first"
- "what would this look like?"
- "before you implement..."
- "hold on"
- "wait"
- "let me see"

**After showing the spec:** "Does this look right? Ready to write tests?"

**After tests are written:** "Tests written (failing). Ready to implement?"

---

## Test ID Conventions

When documenting tests, use prefixes for component/module names:

| Prefix | Component/Module |
|--------|------------------|
| UT | utils |
| API | api handlers |
| SVC | services |
| CMP | components |
| PG | pages |
| HK | hooks |

New components/modules should get a 2-3 letter prefix.

---

## File Locations

| Type | Location |
|------|----------|
| Feature specs | `.specs/features/{domain}/{feature}.feature.md` |
| Test suite docs | `.specs/test-suites/{mirrors test directory}` |
| Design tokens | `.specs/design-system/tokens.md` |
| Component patterns | `.specs/design-system/components/{component}.md` |
| Mapping | `.specs/mapping.md` **(auto-generated)** |
| Cross-cutting learnings | `.specs/learnings.md` |
| Codebase summary | `.specs/codebase-summary.md` |

---

## Auto-Generated Mapping

The `.specs/mapping.md` file is **auto-generated** from feature spec YAML frontmatter.

**Do NOT edit mapping.md directly.** Instead:
1. Update the feature spec's YAML frontmatter
2. Cursor hook auto-regenerates mapping.md on save
3. Or run `./scripts/generate-mapping.sh` manually

This prevents merge conflicts when multiple PRs touch different features.

---

## Always Mention

When working with specs, always tell the user:
- Which spec files you're reading
- Which spec files you're creating/updating
- Which design system files you're creating/referencing
- Any gaps between specs and tests
- Component stubs that need to be filled in

This helps the user track documentation changes.

---

## Component Stub Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMPONENT STUB LIFECYCLE                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  1. /spec-first "user profile"                                          â”‚
â”‚     â””â”€â–¶ Mockup references "Card" component                              â”‚
â”‚     â””â”€â–¶ Card doesn't exist â†’ CREATE STUB                                â”‚
â”‚                                                                         â”‚
â”‚  2. Stub created: .specs/design-system/components/card.md               â”‚
â”‚     Status: ğŸ“ Stub (pending implementation)                            â”‚
â”‚     Purpose: [from context]                                             â”‚
â”‚     Props: _To be documented_                                           â”‚
â”‚                                                                         â”‚
â”‚  3. Implementation happens...                                           â”‚
â”‚                                                                         â”‚
â”‚  4. /design-component card                                              â”‚
â”‚     â””â”€â–¶ Reads actual component code                                     â”‚
â”‚     â””â”€â–¶ Fills in props, variants, usage examples                        â”‚
â”‚     â””â”€â–¶ Status: âœ… Documented                                           â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

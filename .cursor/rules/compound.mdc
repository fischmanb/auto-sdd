---
description: Extract and persist learnings from coding sessions
alwaysApply: false
---

# /compound - Extract Session Learnings

When the user says `/compound`, extract learnings from the current session and persist them.

## Behavior

### 1. Reflect on This Session

Review what was accomplished in this session:
- What patterns worked well?
- What gotchas or edge cases were discovered?
- What decisions were made and why?
- What would be done differently next time?
- Any bugs encountered and how they were fixed?

### 2. Categorize Learnings

#### Feature-Specific Learnings
Learnings that apply to a specific feature go in that feature's spec:
- Add to the `## Learnings` section of the relevant `.specs/features/{domain}/{feature}.feature.md`
- Format:
  ```markdown
  ### YYYY-MM-DD
  - **Pattern**: [What worked well]
  - **Gotcha**: [Edge case or pitfall discovered]
  - **Decision**: [Choice made and why]
  ```

#### Cross-Cutting Learnings
Learnings that apply across features go in `.specs/learnings.md`:
- Patterns that apply to multiple features
- General coding practices for this codebase
- Testing strategies
- Design system usage patterns

#### Critical Rules
Learnings important enough to affect ALL future sessions go in `CLAUDE.md`:
- Security-related patterns
- Critical architectural decisions
- Patterns that prevent common mistakes
- Add to the `## Learned Patterns` section

### 3. Update Files

1. **Feature spec(s)**: Add learnings to `## Learnings` section
2. **Cross-cutting**: Add to `.specs/learnings.md` if it doesn't exist, create it
3. **Critical**: Add to `CLAUDE.md` `## Learned Patterns` section
4. **Frontmatter**: Update `updated:` date in any modified specs

### 4. Commit Changes

```bash
git add .specs/ CLAUDE.md
git commit -m "compound: learnings from [brief session description]"
```

### 5. Summarize

Tell the user:
- How many learnings were captured
- Which files were updated
- Any learnings promoted to CLAUDE.md

---

## Learning Types

| Type | Example | Where to Store |
|------|---------|----------------|
| **Pattern** | "Always debounce form validation to avoid API spam" | Feature spec or learnings.md |
| **Gotcha** | "Safari autofill doesn't trigger onChange events" | Feature spec |
| **Decision** | "Using httpOnly cookies for auth (XSS protection)" | CLAUDE.md if security-related |
| **Bug Fix** | "Fixed race condition by adding loading state check" | Feature spec |
| **Performance** | "Memoize expensive calculations in useMemo" | learnings.md |
| **Testing** | "Mock timers for debounce tests" | learnings.md |

---

## .specs/learnings.md Format

If this file doesn't exist, create it:

```markdown
# Cross-Cutting Learnings

Patterns and practices that apply across this codebase.

## Testing

### YYYY-MM-DD
- [Learning about testing]

## Performance

### YYYY-MM-DD
- [Learning about performance]

## Design System

### YYYY-MM-DD
- [Learning about design system usage]

## API & Data

### YYYY-MM-DD
- [Learning about API patterns]

## General

### YYYY-MM-DD
- [Other learnings]
```

---

## CLAUDE.md Learned Patterns Format

Add to the `## Learned Patterns` section:

```markdown
## Learned Patterns

<!-- Updated by /compound - newest first -->

### YYYY-MM-DD
- **[Category]**: [Concise, actionable learning]

### YYYY-MM-DD
- **[Category]**: [Another learning]
```

---

## When NOT to Compound

- If the session was just reading/exploring (no implementation)
- If no new learnings were discovered
- If learnings are already documented

---

## Example Output

```markdown
## Compound Summary

**Session**: Implemented user login feature

### Learnings Captured: 3

#### Feature-Specific (added to login.feature.md)
- **Gotcha**: Safari autofill requires onBlur handler as backup
- **Pattern**: Debounce email validation to 300ms

#### Cross-Cutting (added to learnings.md)
- **Testing**: Mock fetch globally in setupTests.ts for consistency

#### Promoted to CLAUDE.md
- None this session

### Files Updated
- `.specs/features/auth/login.feature.md`
- `.specs/learnings.md`

---

Consider running `/compound` at the end of significant implementation sessions!
```
